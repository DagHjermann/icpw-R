# icpw-R  

R code for the ICP waters analyses    

Last iteration: files 160-162. 

## Overview of scripts  

### Main scripts

For each of the 'series' 160, 161 and 162, there are four types of files, with naming pattern is as follows:  

```
1. [NUMBER]parm_[description].Rmd       - main code (Rmd for parametrized report)
2. [NUMBER]parm_run_markdown            - code for running script (1) with different parameters (a-d below), creating scripts (3) and (4)  
3. [NUMBER][letter]_[description].html  - resulting html file (cannot be shown on github)   
4. [NUMBER][letter]_[description].md    - resulting markdown file (can be shown on github)   
```

Example:  

1. `160parm_Time_series_results_James.Rmd` - the actual code for the analyses, but with placeholders for names of input data file and output results. This is used for all analyses in the '160 series'.       
* `160parm_run_markdown.R` - a script telling file 1 which input data file to use and how to name the output results. For instance, it says
* `160a_Time_series_results_James_allvars.html` - the outputs   
* `160a_Time_series_results_James_allvars.md`  

The difference between the 160, 161 and 162 results is the response variable:    

```
160: analysis of NO3 trend 1992-2016                     - a,b,c,d: differ in selection of variables  
    - response variable = `no3_decline`, defined as 1 if there was a significant decrease in NO3 over the period 1992-2016 (`slope_no3_vs_time < 0 & p_no3_vs_time <= 0.05`)  
161: analysis of TOC/TON trend 1992-2016                   - a,b,c: as 160  
    - response variable = `tocton_decrease`, defined as 1 if there was a significant decrease in TOC/TON ratio over the period 1992-2016  
162: analysis of median 2012-2016, both NO3 and TOC/TON  - a-b: NO3 with different variables , c-d: TOC/TON with different variables  
    - a and b: response variable = log_median_no3 = log10(median_no3 + 0.1)   
    - c and d: response variable = log_median_tocton = log10(median_tocton)   
```
Note:

> The selection of variables is crucial, as some countries lack some variables. 

Variables used for each analysis:  

```  
For series 160 and 161:  
a - All variables including catchment_area and TOC  
b - All variables except catchment area (but including TOC)  
c - All variables except catchment area and TOC  
d - All variables except catchment area and altitude (but including TOC)  

For series 162:   
a - NO3 medians data set incl. catchment_area + TOC  
b - NO3 medians data set excl. TOC and catchment_area  
c - TOC/TON medians 2012-2016 - all variables  
d - TOC/TON medians data set, but not incuding TOC and TON medians in the analysis    
```


### Helper scripts
```
159                 - reads and put together land cover data. Used by 160, 161, 162
160params_functions - functions used by 160, 161, 162
```  

### Outdated scripts  
```
160_Time_series_results_James.Rmd
160_randomforest_James_data_model1.html (generated by randomForestExplainer::explain_forest()
160_randomforest_James_data_model2.html    " 
160_randomforest_James_data_model3.html    " 
```

